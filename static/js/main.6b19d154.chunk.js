(this["webpackJsonpantd-demo-ts"]=this["webpackJsonpantd-demo-ts"]||[]).push([[0],{42:function(t,e,n){"use strict";n.r(e);var r=n(3),a=n.n(r),i=n(20),o=n(6),c=n(18),u=n(21),s=n(10),p=n.n(s),d=n(19),l=n.n(d),y=p()([l()()]),h=n(44),f=n(1),v="https://api-invest.tinkoff.ru/openapi",m=localStorage.getItem("token");m||(m=prompt("token"),localStorage.setItem("token",m));var b={Authorization:"Bearer ".concat(m)},g=function(){var t=Object(o.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=f.keyBy,t.t1=u.a,t.next=4,Promise.all([y({url:"".concat(v,"/market/stocks"),headers:b}),y({url:"".concat(v,"/market/bonds"),headers:b}),y({url:"".concat(v,"/market/etfs"),headers:b})]);case 4:return t.t2=t.sent,t.t3=(0,t.t1)(t.t2).reduce((function(t,e){var n=e.payload.instruments;return t.concat(n)}),[]),t.abrupt("return",(0,t.t0)(t.t3,"figi"));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),k=function t(e,n,r,a,i,o,u,s,p,d){Object(c.a)(this,t),this.date=e,this.operationType=n,this.price=r,this.quantity=a,this.quantityExecuted=i,this.payment=o,this.comission=u,this.averagePrice=s,this.averageQuantity=p,this.profit=d};(function(){var t=Object(o.a)(a.a.mark((function t(){var e,n,r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y({url:"".concat(v,"/operations"),headers:b,query:{from:Object(h.a)(new Date,4).toISOString(),to:(new Date).toISOString()}}).then((function(t){return t.payload.operations.reverse()}));case 2:return e=t.sent,n=Object(f.groupBy)(Object(f.filter)(e,(function(t){var e=t.operationType;return"Done"===t.status&&["Buy","Sell","BuyCard"].includes(e)})),"figi"),t.next=6,g();case 6:r=t.sent,Object.entries(n).map((function(t){var e=Object(i.a)(t,2),n=e[0],a=e[1];if(r[n]){var o=r[n].ticker,c=a.reduce((function(t,e){var n,r,a,i=(null===(n=Object(f.last)(t))||void 0===n?void 0:n.averagePrice)||e.price,o=(null===(r=Object(f.last)(t))||void 0===r?void 0:r.averageQuantity)||0,c=0,u=0,s=0,p=!1;return e.operationType.includes("Buy")?(c=o+e.quantityExecuted)&&o<0&&c>0&&(p=!0):(c=o-e.quantityExecuted)&&o>0&&c<0&&(p=!0),0!==c?p?(u=e.price,s=(-i+e.price)*o):(c>0&&(e.operationType.includes("Buy")?u=(i*o+e.price*e.quantityExecuted)/c:(u=i,s=(-i+e.price)*e.quantityExecuted)),c<0&&(e.operationType.includes("Sell")?u=(i*o+e.price*e.quantityExecuted)/c:(u=i,s=(-i+e.price)*e.quantityExecuted))):s=(-i+e.price)*o,t.push(new k(e.date,e.operationType,e.price,e.quantity,e.quantityExecuted,e.payment,null===(a=e.commission)||void 0===a?void 0:a.value,u,c,Math.round(100*s)/100)),t}),[]);console.group(o),console.table(c),console.groupEnd()}}));case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}},[[42,1,2]]]);
//# sourceMappingURL=main.6b19d154.chunk.js.map